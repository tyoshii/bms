{% extends "layout.twig" %}

{% block content %}

{% import 'game-nav.twig' as nav %}
{{ nav.navigation() }}

<table class="table">
<thead>
<tr>
<th class="member-id disable">member_id</th>
<th class="order">打順</th>
<th class="name">名前</th>
<th class="number">＃</th>
<th class="detail"></th>
<th>打席数</th>
<th>打数</th>
<th>安打</th>
<th>二塁打</th>
<th>三塁打</th>
<th>本塁打</th>
<th>三振</th>
<th>四球</th>
<th>死球</th>
<th>犠打</th>
<th>犠飛</th>
<th>打点</th>
<th>得点</th>
<th>盗塁</th>
<th>エラー</th>
</thead>

{% for batter in players %}
<tr class="result">
<td class="member-id disable">{{batter.member_id}}</td>
<td class="order">{{batter.order}}</td>
<td class="name">{{batter.name}}</td>
<td class="number">{{batter.number}}</td>
<td class="detail">
<button class="btn btn-info btn-sm" onclick="toggle_detail({{loop.index}});">
打席詳細入力
</button>
</td>

{% set seiseki = batters[batter.member_id].seiseki %}
{% set detail  = batters[batter.member_id].detail  %}

<td class="daseki">{{seiseki.daseki}}</td>
<td class="dasuu">{{seiseki.dasuu}}</td>
<td class="anda">{{seiseki.anda}}</td>
<td class="niruida">{{seiseki.niruida}}</td>
<td class="sanruida">{{seiseki.sanruida}}</td>
<td class="honruida">{{seiseki.honruida}}</td>
<td class="sanshin">{{seiseki.sanshin}}</td>
<td class="yontama">{{seiseki.yontama}}</td>
<td class="shikyuu">{{seiseki.shikyuu}}</td>
<td class="gida">{{seiseki.gida}}</td>
<td class="gihi">{{seiseki.gihi}}</td>
<td class="daten"><input type="number" class="form-control" value="{{seiseki.daten}}" min="0"></td>
<td class="tokuten"><input type="number" class="form-control" value="{{seiseki.tokuten}}" min="0"></td>
<td class="steal"><input type="number" class="form-control" value="{{seiseki.steal}}" min="0"></td>
<td class="error"><input type="number" class="form-control" value="{{seiseki.error}}" min="0"></td>
</tr>

<tr class="disable detail detail-{{loop.index}}">
<th colspan="4"></th>
<th colspan="3">方向</th>
<th colspan="3">種類</th>
<th colspan="3">結果</th>
<th colspan="6"></th>
</tr>

{# meta info #}
{% macro batter_detail_meta(member_id, index) %}
<td class="member-id disable">{{member_id}}</td>
<td class="daseki-number disable">{{index}}</td>

<td class="button" colspan="3">

{% set disable = 'disable' %}
{% if loop.last %}
{% set disable = '' %}
{% endif %}

{% if loop.first %}
<button class="{{disable}} btn btn-info btn-xs add" onClick="add_daseki(this, {{index}});">追加</button>
<button class="{{disable}} btn btn-danger btn-xs delete">削除</button>
{% else %}
<button class="{{disable}} btn btn-info btn-xs add" onClick="add_daseki(this, {{index}});">追加</button>
<button class="{{disable}} btn btn-danger btn-xs delete" onClick="delete_daseki(this, {{index}});">削除</button>
{% endif %}
</td>

<th class="daseki-number-text">第{{index}}打席</th>
{% endmacro %}

{# 結果 #}
{% macro batter_detail_result(results, val) %}
<td colspan="3">
<select class="result">
<option value="0">--</option>
{% for res in results %}
<option value="{{res.id}}" {%if res.id == val%}selected{%endif%}>{{res.result}}</option>
{% endfor %}
</select>
</td>
{% endmacro %}

{# 種類 #}
{% macro batter_result_kind(val) %}
<td colspan="3">
<select class="kind">
<option value="0">--</option>
<option value="1" {%if 1 == val%}selected{%endif%}>ゴロ</option>
<option value="2" {%if 2 == val%}selected{%endif%}>ライナー</option>
<option value="3" {%if 3 == val%}selected{%endif%}>フライ</option>
</select>
</td>
{% endmacro %}

{# 方向 #}
{% macro batter_result_direction(val) %}
<td colspan="3">
<select class="direction">
<option value="0">--</option>
{% for i in 1..9 %}
<option value="{{i}}" {%if i == val%}selected{%endif%}>{{i}}</option>
{% endfor %}
</select>
</td>
{% endmacro %}


{# 打席情報がなければ #}
{% if detail|length == 0 %}
<tr class="result disable detail detail-{{loop.index}}">
{{ _self.batter_detail_meta(batter.member_id, 1) }}
{{ _self.batter_detail_direction(0) }}
{{ _self.batter_detail_kind(0) }}
{{ _self.batter_detail_result(results, 0) }}
<td colspan="6"></td>
</tr>
{% else %}

  {# 打席情報があればループ #}
  {% for d in detail %}
  <tr class="result disable detail detail-{{loop.parent.loop.index}}">
  {{ _self.batter_detail_meta(batter.member_id, loop.index) }}
  {{ _self.batter_detail_direction(d.direction) }}
  {{ _self.batter_detail_kind(d.kind) }}
  {{ _self.batter_detail_result(results, d.result) }}
  <td colspan="6"></td>
  </tr>
  {% endfor %}

{% endif %}

{% endfor %}
</table>

<button class="btn btn-success" onClick="post_batter();">登録</button>


{% endblock content %}

{% block js %}
{{ parent() }}
{% include 'game-js.twig' %}
{% endblock %}
