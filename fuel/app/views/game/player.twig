{% extends "layout/game/edit.twig" %}

{% macro name_select(members, id) %}
<select class="member_id select2" onChange="update_number(this);">
<option value="0">--------------------</option>
{% for member in members %}
<option value="{{member.id}}" {%if member.id == id%}selected{%endif%}>{{member.name}}[{{member.number}}]</option>
{% endfor %}
</select>
{% endmacro %}


{% macro position_select(p) %}
<select class="position">
<option value="0" selected>--</option>
{% for i in 1..9 %}
{% if i == p %}{% set selected = 'selected' %}
{% else %}{% set selected = '' %}
{% endif %}  
<option value="{{i}}" {{selected}}>{{i}}</option>
{% endfor %}
{% for i in ['D','H','R'] %}
{% if p != 0 and i == p %}{% set selected = 'selected' %}
{% else %}{% set selected = '' %}
{% endif %}  
<option value="{{i}}" {{selected}}>{{i}}</option>
{% endfor %}
</select>
{% endmacro %}


{% block content %}

{# header #}
{{ parent() }}

<table id="player" class="table">

<thead>
<tr>
<th class="change"></th>
<th class="order">打順</th>
<th class="name">名前</th>
<th class="number">＃</th>
<th class="position">ポジション1</th>
<th class="position">ポジション2</th>
<th class="position">ポジション3</th>
<th class="position">ポジション4</th>
<th class="position">ポジション5</th>
<th class="position">ポジション6</th>
</tr>
</thead>

<tbody>
{% for meta in metum %}
<tr class="player-tr">
<td class="change">
<button onClick="add_order(this);" class="btn btn-info btn-xs add-order">交代</button>
{% if meta.order == 0 or ( meta.order > 9 and loop.last ) %}
<button onClick="delete_order(this, '{{loop.last}}');" class="btn btn-danger btn-xs delete-order">削除</button>
{% endif %}
</td>
<td class="order">{{- meta.order -}}</td>
<td class="member_id">{{_self.name_select(members, meta.player_id)}}</td>
<td class="number">{{ meta.number }}</td>
{% for pos in meta.position|split(',')%}
<td class="position">{{_self.position_select(pos)}}</td>
{%endfor%}
</tr>
{% endfor %}

<tr>
<td><button onClick="add_order(this, 'last');" class="btn btn-info btn-xs">追加</button>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>

</tbody>
</table>

{# 背番号データ #}
{% for member in members %}
<data id="number-{{member.id}}" class="disable">{{member.number}}</data>
{% endfor %}

{# 登録ボタン #}
<div>
<button onClick="post_player(true);" class="btn btn-success">登録</button>
</div>


{% endblock %}



{% block css %}
{{ parent() }}
<link href="/bootstrap_formhelpers/css/bootstrap-formhelpers.css" rel="stylesheet">
<link href="/select2/select2.css" rel="stylesheet">
{% endblock %}

{% block js %}

{{ parent() }}

<script>
$(document).ready(function() {
    setTimeout("autosave('player');", 30000);
});
</script>
{% endblock %}
